# Тестовое задание
# Задание 1  - Познакомиться и описать принципы (механизмы) работы уязвимости CVE-2023-22515 для Atlassian Confluence Server.

Уязвимость CVE-2023-22515 связана с нарушением контроля доступа в Confluence Data Center и Server и имеет уровень риска "Критический" (CVSS 10). Суть уязвимости заключается в том, что любой неавторизованный пользователь может создать учетную запись администратора Confluence. Это происходит из-за неограниченного доступа к URL-пути /setup/*, включая /setup/setupadministrator.action, что позволяет злоумышленнику отправить POST-запрос для создания учетной записи администратора. В результате, злоумышленник, получив полный административный доступ, может выполнять любые действия в системе, что может привести к нарушению целостности, доступности системы и полной ее компрометации.
# Задание 2  - Разработать NSE скрипт для NMap, который показал наличие или отсутствие вышеупомянутой узявимости.

NSE Скрипт для NMAP находится в файле confluence.nse

# Задание 3  - Предложить простой и быстрый способ протестировать работу скрипта.

1. Запустить Docker Compose файл для Atlassian Confluence Server с уязвимой/безопасной версией:
```
docker-compose -f docker-compose.yml up -d
```
2. Провести предварительную настройку Atlassian Confluence Server:
Получить тестовую лицензию для Confluence: https://my.atlassian.com/license/evaluation
Следовать инструкциям по настройке Confluence после первого запуска.
3. Перенести файл confluence.nse в папку со скриптами NMAP:
```
mv confluence.nse /путь/установки/nmap/scripts/
```
4. Запустить скрипт для проверки уязвимости CVE-2023-22515:
```
nmap --script confluence.nse example.com
```
# Задание 4  - Перечислить какие действия со стороны администратора системы позволили бы ему “скрыть” факт наличие уязвимости.

Существует два способоа скрыть факт наличия данной узявимости:

1. Блокировка доступа к конечным точкам /setup/* на сетевом уровне:
Использование веб-сервер, например, Nginx, для ограничения доступа к уязвимым конечным точкам (Это правило ограничивает доступ ко всем URL, начинающимся с /setup/, возвращая код ответа 403 (Forbidden).)
```
location ~ ^/setup/* {
    return 403;
}
```
2. Изменение конфигурации Confluence:
На каждом узле измените файл конфигурации web.xml, добавив блок кода для ограничения доступа к конечным точкам /setup/*
Открыть файл <confluence-install-dir>/confluence/WEB-INF/web.xml.
Добавить следующий блок кода перед тегом </web-app> в конце файла
```
<security-constraint>
    <web-resource-collection>
        <url-pattern>/setup/*</url-pattern>
        <http-method-omission>*</http-method-omission>
    </web-resource-collection>
    <auth-constraint />
</security-constraint>
```
Это изменение конфигурации ограничивает доступ ко всем конечным точкам /setup/* внутри Confluence, требуя аутентификацию.
Далее необходимо перезапустить Cocnfluence
```
service confluence restart
```
